<Page x:Class="Scrubbler.Host.Presentation.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Scrubbler.Host.Presentation"
      xmlns:navigation="using:Scrubbler.Host.Presentation.Navigation"
      Background="{ThemeResource BackgroundBrush}">

    <Page.Resources>
        <DataTemplate x:Key="MenuItemTemplate" x:DataType="navigation:MenuNavigationItemViewModel">
            <NavigationViewItem Content="{x:Bind Title}"
                                         SelectsOnInvoked="{x:Bind HasChildren, Mode=OneWay, Converter={StaticResource InverseBooleanConverter}}">
                <NavigationViewItem.Icon>
                    <IconSourceElement IconSource="{x:Bind Icon}" />
                </NavigationViewItem.Icon>
                <NavigationViewItem.MenuItemsSource>
                    <Binding Path="Children" />
                </NavigationViewItem.MenuItemsSource>
            </NavigationViewItem>
        </DataTemplate>

        <DataTemplate x:Key="PluginItemTemplate"
              x:DataType="navigation:PluginNavigationItemViewModel">
            <NavigationViewItem SelectsOnInvoked="True">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="8">
                    <ImageIcon Source="{x:Bind Icon}" Width="25" Height="25" VerticalAlignment="Center"/>
                    <TextBlock Text="{x:Bind Title}" VerticalAlignment="Center"/>
                </StackPanel>
            </NavigationViewItem>
        </DataTemplate>

        <navigation:NavigationTemplateSelector
            x:Key="NavigationSelector"
            MenuTemplate="{StaticResource MenuItemTemplate}"
            PluginTemplate="{StaticResource PluginItemTemplate}" />
    </Page.Resources>

    <NavigationView
        MenuItemsSource="{Binding Items}"
        MenuItemTemplateSelector="{StaticResource NavigationSelector}"
        SelectedItem="{Binding SelectedItem, Mode=TwoWay}"
        IsBackButtonVisible="Collapsed"
        IsPaneToggleButtonVisible="True"
        IsSettingsVisible="False"
        PaneDisplayMode="Left"
        CompactPaneLength="80">

        <!-- ALL MAIN UI CONTENT GOES HERE -->
        <NavigationView.Content>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Global InfoBar -->
                <InfoBar x:Name="GlobalInfoBar"
                         Title="Notification"
                         IsOpen="False"
                         HorizontalAlignment="Center"
                         VerticalAlignment="Top"
                         Margin="16"
                         IsClosable="False" />

                <!-- Page or Plugin View -->
                <ContentPresenter Grid.Row="1"
                                  Content="{Binding CurrentViewModel}"
                                  ContentTemplateSelector="{StaticResource ViewLocatorSelector}" />
            </Grid>
        </NavigationView.Content>
    </NavigationView>
</Page>
