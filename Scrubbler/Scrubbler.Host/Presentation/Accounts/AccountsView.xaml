<UserControl
    x:Class="Scrubbler.Host.Presentation.Accounts.AccountsView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Scrubbler.Host.Presentation.Accounts"
    xmlns:utu="using:Uno.Toolkit.UI">

    <ScrollViewer Padding="12">
        <ItemsControl ItemsSource="{Binding Accounts}">
            <ItemsControl.ItemTemplate>
                <DataTemplate x:DataType="local:AccountPluginViewModel">
                    <utu:CardContentControl Style="{StaticResource ElevatedCardContentControlStyle}">
                        <utu:CardContentControl.ContentTemplate>
                            <DataTemplate x:DataType="local:AccountPluginViewModel">
                                <Grid Padding="32">
                                    <!-- Main content -->
                                    <StackPanel Spacing="8" HorizontalAlignment="Center">
                                        <Image Width="64"
                                               Height="64"
                                               Source="{Binding Icon}"
                                               HorizontalAlignment="Center" />
                                        <TextBlock Text="{x:Bind Name}"
                                                   Style="{ThemeResource SubtitleTextBlockStyle}"
                                                   HorizontalTextAlignment="Center"/>

                                        <StackPanel Spacing="8" Orientation="Vertical" Visibility="{x:Bind IsAuthenticated, Mode=OneWay,Converter={StaticResource BoolToVis}}">
                                            <TextBlock Text="Logged in as:" HorizontalTextAlignment="Center"/>
                                            <TextBlock Text="{x:Bind AccountId, Mode=OneWay}"
                                                   Style="{ThemeResource CaptionTextBlockStyle}"
                                                   HorizontalTextAlignment="Center"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                                            <CheckBox Content="Scrobble" HorizontalAlignment="Center" IsEnabled="{x:Bind IsAuthenticated, Mode=OneWay}"
                                                  IsChecked="{x:Bind IsScrobblingEnabled, Mode=TwoWay}"/>
                                            <CheckBox Content="Use Account Functions" HorizontalAlignment="Center" IsChecked="{x:Bind IsUsingAccountFunctions, Mode=TwoWay}"/>
                                            <StackPanel Orientation="Horizontal" Spacing="2" HorizontalAlignment="Center">
                                                <TextBlock Text="Scrobble Limit:"/>
                                                <TextBlock Text="{x:Bind CurrentScrobbleCount}"/>
                                                <TextBlock Text=" / "/>
                                                <TextBlock Text="{x:Bind ScrobbleLimit}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                            <Button Content="Login"
                                                    Command="{x:Bind AuthenticateCommand}"
                                                    Visibility="{x:Bind IsAuthenticated, Mode=OneWay, Converter={StaticResource NotBoolToVis}}"/>
                                            <Button Content="Logout"
                                                    Command="{x:Bind LogoutCommand}"
                                                    Visibility="{x:Bind IsAuthenticated, Mode=OneWay, Converter={StaticResource BoolToVis}}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Busy overlay (dims + blocks input) -->
                                    <Grid Background="{ThemeResource LayerFillColorDefaultBrush}"
                                          Opacity="0.8"
                                          Visibility="{x:Bind IsBusy, Mode=OneWay, Converter={StaticResource BoolToVis}}"/>
                                    <ProgressRing IsActive="{x:Bind IsBusy, Mode=OneWay}"
                                                  Width="32" Height="32"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"/>
                                </Grid>
                            </DataTemplate>
                        </utu:CardContentControl.ContentTemplate>
                    </utu:CardContentControl>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </ScrollViewer>
</UserControl>
