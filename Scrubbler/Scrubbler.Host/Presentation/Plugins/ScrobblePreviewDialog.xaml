<ContentDialog
    x:Class="Scrubbler.Host.Presentation.Plugins.ScrobblePreviewDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:Scrubbler.Abstractions"
    mc:Ignorable="d"
    Title="Scrobble Preview"
    PrimaryButtonText="OK"
    DefaultButton="Primary"
    HorizontalAlignment="Center"
    VerticalContentAlignment="Top">

    <!-- 🔧 Override default Uno/WinUI dialog width -->
    <ContentDialog.Resources>
        <x:Double x:Key="ContentDialogMinWidth">700</x:Double>
        <x:Double x:Key="ContentDialogMaxWidth">1000</x:Double>
    </ContentDialog.Resources>

    <Border
        Background="{ThemeResource ContentDialogBackground}"
        Padding="12"
        CornerRadius="8">

        <ScrollViewer
            VerticalScrollBarVisibility="Auto"
            HorizontalScrollBarVisibility="Disabled"
            MaxHeight="500">

            <StackPanel Spacing="8">
                <TextBlock
                    Text="These tracks will be scrobbled:"
                    FontSize="16"
                    FontWeight="SemiBold"
                    Margin="0,0,0,8" />

                <!-- Table header -->
                <Grid ColumnSpacing="12" Padding="0,0,0,4">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="2*" />
                        <ColumnDefinition Width="180" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="Track" Grid.Column="0" FontWeight="SemiBold" />
                    <TextBlock Text="Artist" Grid.Column="1" FontWeight="SemiBold" />
                    <TextBlock Text="Album" Grid.Column="2" FontWeight="SemiBold" />
                    <TextBlock Text="Played At" Grid.Column="3" FontWeight="SemiBold" TextAlignment="Right" />
                </Grid>

                <!-- Table rows -->
                <ItemsControl ItemsSource="{x:Bind ViewModel.Scrobbles, Mode=OneWay}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="models:ScrobbleData">
                            <Grid ColumnSpacing="12" Padding="0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="180" />
                                </Grid.ColumnDefinitions>

                                <TextBlock
                                    Text="{x:Bind Track}"
                                    Grid.Column="0"
                                    TextTrimming="CharacterEllipsis"
                                    TextWrapping="NoWrap" />

                                <TextBlock
                                    Text="{x:Bind Artist}"
                                    Grid.Column="1"
                                    TextTrimming="CharacterEllipsis"
                                    TextWrapping="NoWrap" />

                                <TextBlock
                                    Text="{x:Bind Album}"
                                    Grid.Column="2"
                                    TextTrimming="CharacterEllipsis"
                                    TextWrapping="NoWrap" />

                                <!-- Use Binding for formatting -->
                                <TextBlock
                                    Grid.Column="3"
                                    Text="{Binding Timestamp.LocalDateTime}"
                                    TextAlignment="Right"
                                    TextWrapping="NoWrap" />
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>

                    <ItemsControl.ItemContainerStyle>
                        <Style TargetType="ContentPresenter">
                            <Setter Property="Margin" Value="0,0,0,4" />
                        </Style>
                    </ItemsControl.ItemContainerStyle>
                </ItemsControl>
            </StackPanel>
        </ScrollViewer>
    </Border>
</ContentDialog>
